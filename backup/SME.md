Small and Medium Enterprise 
===========================

Esta configuración está diseñada pequeñas y medianas empresas ( del Inglés,\textit{ Small And Medium Enterprises}), con las siguientes configuraciones:

\begin{itemize}
\item Una interfaz física como red de área local (LAN) la cual tiene una configuración manual.
\item Creación de las interfaces de VLAN: la VLAN 1 para la administración, la VLAN 100 para un departamento y la VLAN 200 para los servicios asociados a la empresa todas estas con las siguientes IPs respectivamente: 10.10.1.1/29, 10.10.100.1/24, 10.10.200/29.
\item Una interfaz física para acceso al Internet o para la red de área amplia (WAN) la cual tiene una configuración de solicitar IP por DHCP,
\item No posee configuración de VLANs en ninguno de sus puertos
\item Se configura un servidor de DHCP para cada una De las VLANs con las siguientes características:
VLAN 1:
\begin{itemize}
\item \textbf{Interface:} eth1.1
\item \textbf{Network:} 10.10.1.0/29
\item \textbf{Gateway:} 10.10.1.1
\item \textbf{Pool Range:} 10.10.1.2-10.10.1.6
\item \textbf{DNS Server:} 10.10.1.1
\item \textbf{Lease Time:} 70:00:00
\item \textbf{Authoritative:} Sí
\end{itemize}
VLAN 100:
\begin{itemize}
\item \textbf{Interface:} eth1.100
\item \textbf{Network:} 10.10.100.0/29
\item \textbf{Gateway:} 10.10.100.1
\item \textbf{Pool Range:} 10.10.100.2-10.10.100.254
\item \textbf{DNS Server:} 10.10.100.1
\item \textbf{Lease Time:} 70:00:00
\item \textbf{Authoritative:} Sí
\end{itemize}
VLAN 200:
\begin{itemize}
\item \textbf{Interface:} eth1.200
\item \textbf{Network:} 10.10.200.0/29
\item \textbf{Gateway:} 10.10.200.1
\item \textbf{Pool Range:} 10.10.200.2-10.10.200.6
\item \textbf{DNS Server:} 10.10.200.1
\item \textbf{Lease Time:} 70:00:00
\item \textbf{Authoritative:} Sí
\end{itemize}

\item Reglas de firewall para protección de la red:

\begin{listing}[H]
\begin{minted}[escapeinside=||, linenos,baselinestretch=0.5,fontsize=\footnotesize]{bash}
# Generated by Daniel Rivero on Wed 30 2018
*filter
:INPUT DROP [0:0]
:FORWARD ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
# INPUT RULES
# Accept loopback ingoing traffic
-A INPUT -i lo -j ACCEPT
-A INPUT -s 127.0.0.0/8 ! -i lo -j REJECT --reject-with icmp-port-unreachable
# Accept limited icmp ingoing traffic
-A INPUT -p icmp -m state --state NEW -m icmp --icmp-type 8 -j ACCEPT
-A INPUT -p icmp -m state --state RELATED,ESTABLISHED -j ACCEPT
# Accept SSH port connections 
-A INPUT -i eth0 -p tcp -m state --state NEW,ESTABLISHED -m tcp --dport 22 -j ACCEPT
# Accept Domain name resolve 
-A INPUT -i eth0 -p udp -m state --state ESTABLISHED -m udp --sport 53 -j ACCEPT
# Accept HTTPS name resolve 
-A INPUT -i eth0 -p tcp -m state --state ESTABLISHED -m tcp --sport 443 -j ACCEPT
-A INPUT -i eth0 -p tcp -m state --state NEW,ESTABLISHED -m tcp --dport 443 -j ACCEPT
# Allow port 19999/tcp for device monitoring via browser using netdata
-A INPUT -p tcp -m tcp --dport 19999 -j ACCEPT
# limit number of packages per minute 
-A INPUT -m limit --limit 3/min -j LOG --log-prefix "iptables_INPUT_denied: "
-A INPUT -j REJECT --reject-with icmp-port-unreachable
# Log all dropped ingoing traffic
-A INPUT -j LOG --log-prefix="BAD_INPUT:"
-A INPUT -j DROP
# FORWARD RULES
-A FORWARD -m limit --limit 3/min -j LOG --log-prefix "iptables_FORWARD_denied: "
-A FORWARD -j REJECT --reject-with icmp-port-unreachable
# Accept loopback outgoing traffic
-A OUTPUT -o lo -j ACCEPT
# Accept icmp outgoing traffic
-A OUTPUT -p icmp -j ACCEPT
-A OUTPUT -o eth0 -p udp -m state --state NEW,ESTABLISHED -m udp --dport 53 -j ACCEPT
-A OUTPUT -o eth0 -p tcp -m state --state NEW,ESTABLISHED -m tcp --sport 22 -j ACCEPT
-A OUTPUT -o eth0 -p tcp -m state --state NEW,ESTABLISHED -m tcp --dport 443 -j ACCEPT
-A OUTPUT -o eth0 -p tcp -m state --state ESTABLISHED -m tcp --dport 443 -j ACCEPT
-A OUTPUT -m limit --limit 3/min -j LOG --log-prefix "iptables_OUTPUT_denied: "
-A OUTPUT -j REJECT --reject-with icmp-port-unreachable
# Log all dropped outgoing traffic
-A OUTPUT -j LOG --log-prefix="BAD_OUTPUT:"
#-A OUTPUT -j DROP
COMMIT
# nat rules
*nat
:PREROUTING ACCEPT [0:0]
:INPUT ACCEPT [0:0]
:OUTPUT ACCEPT [0:0]
:POSTROUTING ACCEPT [0:0]
# POSTROUTING RULES
# masquerate the private network
-A POSTROUTING -o eth0 -j MASQUERADE
# PREROUTING RULES
# redirect all DNS queries to the router
-A PREROUTING ! -s 10.10.1.1/32 ! -d 10.10.1.1/32 -p tcp -m tcp --dport 53 \
-j DNAT --to-destination 10.10.1.1:53
-A PREROUTING ! -s 10.10.1.1/32 ! -d 10.10.1.1/32 -p udp -m udp --dport 53 \
-j DNAT --to-destination 10.10.1.1:53
-A PREROUTING ! -s 10.10.100.1/32 ! -d 10.10.100.1/32 -p tcp -m tcp --dport 53 \
-j DNAT --to-destination 10.10.100.1:53
-A PREROUTING ! -s 10.10.100.1/32 ! -d 10.10.100.1/32 -p udp -m udp --dport 53 \
-j DNAT --to-destination 10.10.100.1:53
-A PREROUTING ! -s 10.10.200.1/32 ! -d 10.10.200.1/32 -p tcp -m tcp --dport 53 \
-j DNAT --to-destination 10.10.200.1:53
-A PREROUTING ! -s 10.10.200.1/32 ! -d 10.10.200.1/32 -p udp -m udp --dport 53 \
-j DNAT --to-destination 10.10.200.1:53
COMMIT
\end{minted}
  \caption{Reglas de \textit{Firewall} para la configuración interna SME}
    \label{lst-sme}
\end{listing}

\item Regla de NAT para enmascarar todos los paquetes saliendo de la LAN (adicionado en las reglas de Firewall).
\item Servicio de DNS
\item Cliente de NTP activado por defecto

\end{itemize}
